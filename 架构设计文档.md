# 前端权限管理系统详细设计文档


## 1. 项目概述

### 1.1 项目目标
构建一套完整的前端权限管理系统，支持用户认证、用户管理、组织架构管理、权限与角色管理、菜单权限控制等核心功能，提供安全、高效、可扩展的权限管理解决方案。

### 1.2 项目范围
覆盖用户认证、用户管理、组织架构、权限核心功能、关联管理、权限检查、菜单权限管理及系统优化等全流程功能模块（对应需求中的八个阶段任务）。

### 1.3 核心功能
- 用户认证与令牌管理（登录/登出/令牌刷新）
- 用户信息管理（增删改查/状态管理）
- 组织架构管理（组层级结构/关联管理）
- 权限与角色管理（权限定义/角色分配）
- 动态菜单与权限控制
- 系统配置与优化


## 2. 架构设计

### 2.1 整体架构
采用分层架构设计，包含以下核心层次：
```
表现层（UI）→ 业务逻辑层 → 数据访问层 → 基础设施层
```

- **表现层**：页面组件、通用组件、布局组件
- **业务逻辑层**：状态管理、权限控制逻辑、业务规则
- **数据访问层**：API请求封装、数据转换
- **基础设施层**：路由配置、HTTP客户端、工具函数

### 2.2 技术栈选型
| 技术领域         | 选型方案                  | 选型理由                          |
|------------------|---------------------------|-----------------------------------|
| 前端框架         | React                  | 组件化开发、生态丰富、性能优异    |
| 状态管理         | Redux Toolkit             | 简化Redux使用、内置中间件支持     |
| 路由管理         | React Router             | 支持嵌套路由、路由守卫            |
| HTTP客户端       | Axios                     | 拦截器功能、请求/响应处理完善     |
| UI组件库         | Ant Design               | 企业级组件丰富、支持权限控制      |
| 表单处理         | Formik + Yup              | 表单状态管理与验证一体化          |
| 类型检查         | TypeScript                | 静态类型校验、提升代码可维护性    |
| 构建工具         | Vite                      | 开发热更新快、构建性能优异        |
| 代码规范         | ESLint + Prettier         | 统一代码风格、减少代码缺陷        |


## 3. 模块详细设计

### 3.1 基础框架模块

#### 3.1.1 项目目录结构
```
src/
├── assets/           # 静态资源（图片、样式）
├── components/       # 通用组件
│   ├── common/       # 基础组件（按钮、输入框等）
│   ├── layout/       # 布局组件
│   └── business/     # 业务组件（权限选择器等）
├── pages/            # 页面组件
│   ├── auth/         # 认证相关页面
│   ├── user/         # 用户管理页面
│   ├── group/        # 组织管理页面
│   ├── permission/   # 权限管理页面
│   └── role/         # 角色管理页面
├── store/            # 状态管理
│   ├── slices/       # Redux切片
│   └── index.ts      #  store配置
├── services/         # API服务
│   ├── api.ts        # Axios配置
│   ├── auth.ts       # 认证相关接口
│   └── ...           # 其他业务接口
├── router/           # 路由配置
│   ├── index.ts      # 路由注册
│   └── routes.ts     # 路由定义
├── utils/            # 工具函数
├── hooks/            # 自定义钩子
├── types/            # TypeScript类型定义
└── App.tsx           # 应用入口组件
```

#### 3.1.2 路由系统设计
- 采用嵌套路由设计，支持布局复用
- 实现路由守卫（`PrivateRoute`组件），验证用户登录状态
- 动态路由配置，基于用户权限生成可访问路由列表

```typescript
// 路由配置示例
const routes = [
  {
    path: '/login',
    component: LoginPage,
    public: true // 公开路由，无需认证
  },
  {
    path: '/',
    component: MainLayout,
    children: [
      { path: 'users', component: UserList, permission: 'user:list' },
      { path: 'users/:id', component: UserDetail, permission: 'user:view' },
      // 其他路由...
    ]
  }
];
```

#### 3.1.3 HTTP客户端配置
- 配置Axios实例，设置基础URL、超时时间
- 实现请求拦截器：添加令牌、处理请求参数
- 实现响应拦截器：处理错误、令牌过期自动刷新

```typescript
// services/api.ts
import axios from 'axios';
import { refreshToken, getToken, clearAuth } from './auth';

const api = axios.create({
  baseURL: '/api/v1',
  timeout: 10000
});

// 请求拦截器
api.interceptors.request.use(config => {
  const token = getToken();
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器
api.interceptors.response.use(
  response => response,
  async error => {
    const originalRequest = error.config;
    // 处理401令牌过期
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      try {
        const newToken = await refreshToken();
        originalRequest.headers.Authorization = `Bearer ${newToken}`;
        return api(originalRequest);
      } catch (err) {
        clearAuth(); // 刷新失败，清除认证信息
        window.location.href = '/login';
        return Promise.reject(err);
      }
    }
    return Promise.reject(error);
  }
);
```


### 3.2 认证模块

#### 3.2.1 登录流程设计
1. 用户输入用户名/密码提交登录表单
2. 前端表单验证（非空、格式校验）
3. 调用登录接口（`POST /api/v1/auth/login`）
4. 登录成功：
   - 存储令牌（accessToken、refreshToken）
   - 获取用户信息并存储到全局状态
   - 跳转到首页
5. 登录失败：显示错误提示（账号密码错误、服务器异常等）

#### 3.2.2 令牌管理机制
- **存储方式**：
  - accessToken：存储在内存+sessionStorage（内存用于避免刷新丢失，sessionStorage用于页面刷新恢复）
  - refreshToken：存储在HttpOnly Cookie（增强安全性）
- **刷新机制**：
  - 定时检查令牌过期时间（提前30s刷新）
  - 请求401错误时触发刷新
  - 刷新失败则自动登出

#### 3.2.3 权限验证设计
- 页面级验证：通过路由守卫检查用户是否有权限访问
- 按钮级验证：通过权限组件控制按钮显示/禁用

```tsx
// 权限控制组件示例
const PermissionGuard = ({ permission, children }) => {
  const { userPermissions } = useSelector(state => state.auth);
  if (userPermissions.includes(permission)) {
    return children;
  }
  return null; // 无权限时不渲染
};

// 使用方式
<PermissionGuard permission="user:create">
  <Button type="primary" onClick={handleAddUser}>新增用户</Button>
</PermissionGuard>
```


### 3.3 用户管理模块

#### 3.3.1 核心功能设计
- **用户列表**：支持分页、搜索、筛选（状态/组织）
- **用户详情**：展示基本信息、所属组织、拥有权限
- **用户创建/编辑**：表单验证（字段规则、唯一性检查）
- **用户删除**：二次确认机制，防止误操作
- **密码管理**：密码强度校验，修改/重置流程

#### 3.3.2 组件设计
```tsx
// 用户列表组件结构
const UserList = () => {
  const [pagination, setPagination] = useState({ page: 1, pageSize: 10, total: 0 });
  const [filters, setFilters] = useState({ keyword: '', status: '' });
  const { users, loading } = useSelector(state => state.user);
  
  useEffect(() => {
    fetchUsers({ ...pagination, ...filters });
  }, [pagination, filters]);
  
  return (
    <div>
      <SearchBar onSearch={handleSearch} />
      <Table
        dataSource={users}
        columns={columns}
        pagination={pagination}
        loading={loading}
        onchange={handleTableChange}
      />
    </div>
  );
};
```


### 3.4 组织架构模块

#### 3.4.1 组层级展示设计
- 采用树形组件展示组层级关系
- 支持展开/折叠、层级导航
- 区分不同类型组（医院/院区/科室/小组）的显示样式

#### 3.4.2 用户组关联设计
- 使用穿梭框组件实现用户与组的关联管理
- 左侧展示可选用户/组，右侧展示已关联项
- 支持批量操作和搜索筛选


### 3.5 权限与角色模块

#### 3.5.1 权限模型设计
采用RBAC（基于角色的访问控制）模型：
- 权限：最小权限单元（如`user:list`、`user:create`）
- 角色：一组权限的集合（如"管理员"包含所有权限）
- 用户：关联多个角色，继承角色的所有权限

#### 3.5.2 角色权限分配设计
- 采用树形结构展示权限分类
- 支持全选/反选、级联选择
- 分配历史记录与差异展示
- 提交时仅发送变更的权限数据（优化性能）


### 3.6 菜单管理模块

#### 3.6.1 动态菜单生成
1. 登录后获取用户有权访问的菜单列表（`GET /api/v1/user/:id/menus`）
2. 转换菜单数据为路由配置格式
3. 动态生成侧边栏菜单和路由配置

#### 3.6.2 菜单权限关联
- 菜单与权限多对多关联
- 控制菜单的可见性（基于权限）
- 控制菜单下操作按钮的可用性（基于权限）


## 4. 安全设计

### 4.1 认证安全
- 密码传输采用HTTPS加密
- 令牌过期策略（accessToken短期，refreshToken长期）
- 防止CSRF攻击（请求携带CSRF Token）
- 登录失败次数限制（前端配合后端实现）

### 4.2 数据安全
- 敏感数据脱敏展示（如手机号、身份证）
- 防止XSS攻击（输入验证、输出编码）
- 权限严格校验（前端控制+后端验证双重保障）


## 5. 性能优化策略

1. **资源优化**：
   - 组件懒加载（`React.lazy` + `Suspense`）
   - 路由按需加载
   - 静态资源CDN分发

2. **数据优化**：
   - 接口数据缓存（重复请求避免重复加载）
   - 分页加载大数据列表
   - 列表虚拟滚动（处理万级以上数据）

3. **渲染优化**：
   - 组件 memo 化（`React.memo`）
   - 避免不必要的重渲染
   - 复杂计算使用`useMemo`缓存结果


## 6. 测试策略

### 6.1 单元测试
- 测试框架：Jest
- 测试范围：工具函数、hooks、组件逻辑
- 核心测试点：权限检查逻辑、表单验证、状态更新

### 6.2 端到端测试
- 测试框架：Cypress
- 测试场景：
  - 登录/登出流程
  - 用户管理核心操作
  - 权限控制效果验证
  - 菜单访问控制


## 7. 部署方案

1. **构建流程**：
   - 开发环境：`vite dev`（热更新）
   - 测试环境：`vite build --mode test`（测试配置）
   - 生产环境：`vite build`（代码压缩、tree-shaking）

2. **部署方式**：
   - 静态资源部署到Nginx服务器
   - 配置Gzip压缩、缓存策略
   - 配合CI/CD流水线实现自动部署


## 8. 扩展与维护

1. **可扩展性设计**：
   - 组件化设计，支持复用
   - 配置化开发（如表单配置、表格列配置）
   - 插件化架构（支持功能模块按需加载）

2. **维护策略**：
   - 完善的注释文档（组件API、核心逻辑）
   - 代码规范与审查机制
   - 版本控制与变更记录


## 附录：核心API列表

| 模块       | 接口                          | 方法   | 功能描述               |
|------------|-------------------------------|--------|------------------------|
| 认证       | `/api/v1/auth/login`          | POST   | 用户登录               |
| 认证       | `/api/v1/auth/refresh`        | POST   | 刷新令牌               |
| 用户管理   | `/api/v1/users`               | GET    | 获取用户列表           |
| 用户管理   | `/api/v1/user/create`         | POST   | 创建用户               |
| 组织管理   | `/api/v1/groups`              | GET    | 获取组列表             |
| 权限管理   | `/api/v1/permissions`         | GET    | 获取权限列表           |
| 角色管理   | `/api/v1/roles`               | GET    | 获取角色列表           |
| 角色管理   | `/api/v1/role/:id/permissions`| POST   | 分配角色权限           |
| 菜单管理   | `/api/v1/menus`               | GET    | 获取菜单列表           |
| 用户权限   | `/api/v1/user/:id/permissions`| GET    | 获取用户权限列表       |

---

本设计文档将作为前端开发的指导依据，开发过程中如需调整，需经过评审并更新文档。